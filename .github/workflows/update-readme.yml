name: Fetch GitHub Activities

on:
  push:
    branches:
      - main
  schedule:
    - cron: '0 * * * *'  # This will run the workflow every hour (adjust as necessary)

jobs:
  fetch-activities:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '14'  # You can specify the version you need

    - name: Install Axios
      run: npm install axios

    - name: Fetch Recent GitHub Activities
      id: get-activities
      run: |
        echo "Fetching recent activities for gjrahul1..."
        node -e "
          const axios = require('axios');

          const username = 'gjrahul1';  // Replace with your GitHub username
          const token = process.env.README_WORKFLOW_DISPLAY;  // Use the secret token

          async function fetchActivities() {
            try {
              const response = await axios.get('https://api.github.com/users/' + username + '/events/public', {
                headers: {
                  Authorization: 'token ' + token
                }
              });

              const activities = response.data.map(event => {
                const repo = event.repo.name;
                const url = 'https://github.com/' + repo;
                let action;

                if (event.type === 'PushEvent') {
                  action = 'pushed to';
                } else if (event.type === 'PullRequestEvent' && event.payload.action === 'merged') {
                  action = 'merged into';
                } else {
                  action = 'updated in';  // For other updates like PRs opened, issues, etc.
                }

                return '- ' + action + ' [' + repo + '](' + url + ')';
              }).join('\\n');

              console.log(activities || 'No recent activities found.');
            } catch (error) {
              console.error('Error fetching activities: ' + error.message);
              process.exit(1);
            }
          }

          fetchActivities();
        "
      env:
        README_WORKFLOW_DISPLAY: ${{ secrets.ReadMe_WorkFlow_Display }}  # Reference the secret here
